<!DOCTYPE html>
<html lang="de">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="UTF-8"/>
    <title>Translator</title>
    <style>
        table {{ table-layout: fixed; width: 100%; }
        table, td, th {{ border: 1px solid black; border-collapse:collapse;border-spacing:0; }
        td, th {{ padding: 3px; margin: 0px; }
        body {{ font-family: sans-serif;
                -moz-hyphens: auto;
                -o-hyphens: auto;
                -webkit-hyphens: auto;
                -ms-hyphens: auto;
                hyphens: auto;
             }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {{
        $(".editable_translation").keydown(function(event) {{
             if (event.which == 13) {{
                 event.cancelBubble = true;
                 event.preventDefault();
                 event.stopPropagation();
                 insertTranslationIntoDB(this);
             }
        });
        $(".editable_translation").blur(function() {{
            insertTranslationIntoDB(this);
        });
        
    });

    function insertTranslationIntoDB(object) {{
       var index = $(object).attr("index");
       var gnd_code = $(object).attr("gnd_code");
       var language_code = $(object).closest('table').find('th').eq($(object).index()).text(); //Determine anguage from the heading
       var old_translation = $(object).attr("translation");
       var translation = $(object).text();
       if (translation == old_translation) 
           return;

       $(object).attr("translation", translation);
       var action = (old_translation == '') ? "insert" : "update"
       $.ajax({{
          type: "PUT",
          url: "translator_ajax",
          data: "index=" + index + "&gnd_code=" + gnd_code + "&language_code=" + language_code 
                         + "&translation=" + translation + "&action=" + action,
          success: function(json) {{
             $(object).css("background-color", "yellow");
          }, // end success

          error: function (xhr, ajaxOptions, thrownError) {{
                   $(object).css("background-color", "red");
                   alert("Writing to database failed");
          }
       }); // end ajax
    }
    </script>

</head>
    <body>
        <h1 align="center"><a href="/cgi-bin/translator">IxTheo Translation Tool</a></h1>
        <p>
        <div style="text-align: center;">
            <h4>Logged in as {translator}</h4>
            <form action="/cgi-bin/translator">
                    Please select target scope <select name="target" onchange="if(this.value != '{target_translation_scope}') this.form.submit()">
                    <option value="vufind" {IF target_translation_scope == "vufind"} selected {ENDIF}>VuFind Translations</option>
                    <option value="keywords" {IF target_translation_scope == "keywords"} selected {ENDIF}>Keyword Translations</option>
            </select>
            </form>
        </div> 
        <p>
        <div style="text-align: center;">
            <form action="/cgi-bin/translator" method="POST">
                <input type="text" name="lookfor" value="{lookfor}" /><button>Search</button>
            </form>
        </div>
        <div style="clear: both;">
            <div style="width: 50%; float: left; text-align: right">
                <form action="/cgi-bin/translator" method="POST">
                    <button>Previous</button>
                    <input type="hidden" name="lookfor" value="{lookfor}">
                    <input type="hidden" name="offset" value="{prev_offset}">
                    <input type="hidden" name="target" value="{target_translation_scope}">
                </form>
            </div>
            <div style="width: 50%; float: right;">
                <form action="/cgi-bin/translator" method="POST">
                    <button>Next</button>
                    <input type="hidden" name="lookfor" value="{lookfor}">
                    <input type="hidden" name="offset" value="{next_offset}">
                    <input type="hidden" name="target" value="{target_translation_scope}">
                </form>
            </div>
            {IF target_translation_scope == "vufind"}
            <div style="width: 90%;">
                <h2>VuFind Translations</h2>
                              <table>
                    <tr>{vufind_token_table_headline}</tr>
                    {LOOP vufind_token_row}
                    <tr>
                        {vufind_token_row}
                    </tr>
                    {ENDLOOP}
                </table>
            </div>
            {ELSE}
            <div style="width: 90%;">
                <h2>Keyword Translations</h2>
                    <table>
                    <tr>{keyword_table_headline}</tr>
                    {LOOP keyword_row}
                    <tr>
                        {keyword_row}
                    </tr>
                    {ENDLOOP}
                </table>
            </div>
            {ENDIF}
        </div>
    </body>
</html>
