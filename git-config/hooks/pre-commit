#!/bin/bash
set -o errexit -o nounset


# python syntax check
python3 -m py_compile /usr/local/ub_tools/cronjobs/*.py


# Format C++ source files:
readonly changed_files=$(git diff --cached --name-only --diff-filter=ACM)
readonly GIT_ROOT=$(git rev-parse --show-toplevel)
for changed_file in changed_files; do
    readonly extension="${changed_file##*.}"
    if [[ $extension == "cc" || $extension == "h" ]]; then
        # "-style=file" has the effect of searching up the directory tree until a file named ".clang-format" is found and then using it.
        clang-format-12 -style=file -i "$GIT_ROOT/$changed_file"
    fi
done


exit 0
